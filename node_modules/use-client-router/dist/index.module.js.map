{"version":3,"file":"index.module.js","sources":["../src/index.ts"],"sourcesContent":["import router, { makePublicRouterInstance, useRouter } from 'next/router';\nimport { match } from 'path-to-regexp';\nimport replaceString from \"replace-string\";\n\nimport type { Router, NextRouter } from 'next/router';\nimport type { MatchResult } from 'path-to-regexp';\nimport type { ParsedUrlQuery } from 'querystring';\n\n/**\n * Current Next.js router on client have a strange behaviour\n * the router.query is an empty object on first render\n * others routers like react-router have the query|params always available\n *\n * Wrap Next.js router with resolved pathname and query\n */\nfunction fixClientRouter(): NextRouter {\n\tif (typeof window !== 'undefined') {\n\t\tconst windowPathname = window.location.pathname;\n\n\t\tconst routerPathname = router.pathname;\n\t\tconst firstRoutePart = replaceString(routerPathname, '[', ':');\n\t\tconst readyToPathToRegExpProcess = replaceString(firstRoutePart, ']', '');\n\n\t\treturn {\n\t\t\t...makePublicRouterInstance(router.router as Router),\n\t\t\tpathname: windowPathname,\n\t\t\tquery: (match(readyToPathToRegExpProcess)(windowPathname) as MatchResult<ParsedUrlQuery>).params,\n\t\t};\n\t} else {\n\t\t// this empty fake router is for Next.js server throw the error about router usage on server-side\n\t\treturn { query: {}, pathname: '', route: '', asPath: '', basePath: '' } as NextRouter;\n\t}\n}\n\n/**\n * Make next router *query* and *pathname* available on first-render\n */\nexport const useClientRouter = (): NextRouter => {\n\t// use next original router here to listen route changes\n\t// without this, the route will change and the component that uses this hook\n\t// won't receive the updated pathname and query\n\tuseRouter();\n\n\treturn fixClientRouter();\n};\n"],"names":["useClientRouter","useRouter","window","windowPathname","location","pathname","firstRoutePart","replaceString","router","readyToPathToRegExpProcess","makePublicRouterInstance","query","match","params","route","asPath","basePath","fixClientRouter"],"mappings":"6VAqCaA,IAAAA,EAAkB,WAM9B,OAFAC,IA1BD,WACC,GAAsB,oBAAXC,OAAwB,CAClC,IAAMC,EAAiBD,OAAOE,SAASC,SAGjCC,EAAiBC,EADAC,EAAOH,SACuB,IAAK,KACpDI,EAA6BF,EAAcD,EAAgB,IAAK,IAEtE,YACII,EAAyBF,EAAOA,SACnCH,SAAUF,EACVQ,MAAQC,EAAMH,EAANG,CAAkCT,GAAgDU,SAI3F,MAAO,CAAEF,MAAO,GAAIN,SAAU,GAAIS,MAAO,GAAIC,OAAQ,GAAIC,SAAU,IAa7DC"}